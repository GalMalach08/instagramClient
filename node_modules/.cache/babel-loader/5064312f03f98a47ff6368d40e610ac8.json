{"ast":null,"code":"import _objectSpread from\"C:/Users/\\u05DE\\u05DC\\u05D0\\u05DA \\u05D2\\u05DC/Desktop/Projects/Instagram-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/\\u05DE\\u05DC\\u05D0\\u05DA \\u05D2\\u05DC/Desktop/Projects/Instagram-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/\\u05DE\\u05DC\\u05D0\\u05DA \\u05D2\\u05DC/Desktop/Projects/Instagram-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/\\u05DE\\u05DC\\u05D0\\u05DA \\u05D2\\u05DC/Desktop/Projects/Instagram-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';// material ui\nimport{Input,IconButton,Collapse,TextField,Button,InputAdornment}from'@material-ui/core';import ImageIcon from'@material-ui/icons/Image';import CloseIcon from'@material-ui/icons/Close';import VisibilityIcon from'@material-ui/icons/Visibility';import VisibilityOffIcon from'@material-ui/icons/VisibilityOff';import Alert from'@material-ui/lab/Alert';// bootstrap \nimport Modal from'react-bootstrap/Modal';// Formik\nimport{Formik}from'formik';import*as Yup from'yup';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditProfile=function EditProfile(_ref){var modal=_ref.modal,setModal=_ref.setModal;var _JSON$parse=JSON.parse(localStorage.getItem('user')),id=_JSON$parse.id;var closeModal=function closeModal(){return setModal(false);};var _useState=useState(''),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),openAlert=_useState4[0],setOpenAlert=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),fileName=_useState6[0],setFileName=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),previewSource=_useState8[0],setPreviewSource=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isProfile=_useState10[0],setIsProfile=_useState10[1];var _useState11=useState({username:'',password:'',description:''}),_useState12=_slicedToArray(_useState11,2),userProfile=_useState12[0],setUserProfile=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),showPassword=_useState14[0],setShowPassword=_useState14[1];// Formik\nvar validationSchema=Yup.object().shape({username:Yup.string().required('username is required'),password:Yup.string().required('password is required'),description:Yup.string().min(6,'That it? write some more(min 6 characters)')});var errorHelper=function errorHelper(formik,values){return{error:formik.errors[values]&&formik.touched[values]?true:false,helperText:formik.errors[values]&&formik.touched[values]?formik.errors[values]:null};};// Get user's information\nvar getUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data,_data$user,username,password,profileFileName,profileDescription;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"/user/\".concat(id));case 2:res=_context.sent;_context.next=5;return res.json();case 5:data=_context.sent;_data$user=data.user,username=_data$user.username,password=_data$user.password,profileFileName=_data$user.profileFileName,profileDescription=_data$user.profileDescription;setUserProfile({username:username,password:password,description:profileDescription,photo:''});setFileName(profileFileName);case 9:case\"end\":return _context.stop();}}},_callee);}));return function getUser(){return _ref2.apply(this,arguments);};}();// turn the image file to url\nvar editProfile=function editProfile(values,resetForm){values.fileName=fileName;if(typeof values.photo==='object'){var reader=new FileReader();reader.readAsDataURL(values.photo);reader.onloadend=function(){values.photo=reader.result;updateSettings(values,resetForm);};}else{updateSettings(values,resetForm);}};// update the user profile\nvar updateSettings=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values,resetForm){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch('/user',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify(_objectSpread(_objectSpread({},values),{},{id:id,fileName:fileName}))});case 2:response=_context2.sent;_context2.next=5;return response.json();case 5:data=_context2.sent;if(data.user){localStorage.setItem('user',JSON.stringify(data.user));resetForm();setModal(false);}else{setMessage(data.error);setOpenAlert(true);}case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function updateSettings(_x,_x2){return _ref3.apply(this,arguments);};}();// Handle password visiblity \nvar handleClickShowPassword=function handleClickShowPassword(){setShowPassword(!showPassword);};// Handle image change  \nvar handleChangeImage=function handleChangeImage(e,setFieldValue){var reader=new FileReader();setFieldValue(\"photo\",e.target.files[0]);if(e.target.files.length===0){setIsProfile(false);setFileName('');setPreviewSource('');}else{reader.readAsDataURL(e.target.files[0]);reader.onloadend=function(){setPreviewSource(reader.result);};setIsProfile(true);setFileName(e.target.files[0].name);}};useEffect(function(){getUser();},[]);return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Modal,{size:\"lg\",centered:true,show:modal,onHide:closeModal,children:[/*#__PURE__*/_jsxs(Modal.Header,{className:\"\",children:[\" \",/*#__PURE__*/_jsx(Modal.Title,{style:{fontWeight:'700',margin:'auto'},children:\" Edit your profile \"}),\" \"]}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(Formik,{initialValues:userProfile,onSubmit:function onSubmit(values,_ref4){var resetForm=_ref4.resetForm;return editProfile(values,resetForm);},validationSchema:validationSchema,enableReinitialize:true,children:function children(props){return/*#__PURE__*/_jsxs(\"form\",{style:{textAlign:'center'},onSubmit:props.handleSubmit,autoComplete:\"off\",children:[/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({name:\"username\",label:\"User name\",variant:\"outlined\",fullWidth:true},props.getFieldProps('username')),errorHelper(props,'username'))),/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({InputProps:{endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",children:/*#__PURE__*/_jsxs(IconButton,{onClick:handleClickShowPassword,children:[\" \",showPassword?/*#__PURE__*/_jsx(VisibilityOffIcon,{}):/*#__PURE__*/_jsx(VisibilityIcon,{}),\"  \"]})})},type:showPassword?\"text\":\"password\",variant:\"outlined\",margin:\"normal\",fullWidth:true,name:\"password\",label:\"Password\"},props.getFieldProps('password')),errorHelper(props,'password'))),/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({multiline:true,rows:4,variant:\"outlined\",margin:\"normal\",fullWidth:true,label:\"add profile description\",name:\"description\"},props.getFieldProps('description')),errorHelper(props,'description'))),/*#__PURE__*/_jsx(Input,{id:\"file\",className:\"inputfile\",type:\"file\",name:\"photo\",onChange:function onChange(e){return handleChangeImage(e,props.setFieldValue);},hidden:true}),/*#__PURE__*/_jsxs(Button,{style:{display:'block',margin:'5px 0px'},color:\"primary\",variant:\"outlined\",children:[/*#__PURE__*/_jsx(ImageIcon,{className:\"\"}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"file\",children:[fileName?\"\".concat(fileName,\" UPLOADED\"):'IMAGE PROFILE',\" \"]})]}),props.errors.photo&&props.touched.photo?/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:props.errors.photo}):null,/*#__PURE__*/_jsx(Collapse,{in:openAlert,children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",action:/*#__PURE__*/_jsxs(IconButton,{color:\"inherit\",size:\"small\",onClick:function onClick(){return setOpenAlert(false);},children:[\" \",/*#__PURE__*/_jsx(CloseIcon,{fontSize:\"inherit\"}),\" \"]}),children:message})}),/*#__PURE__*/_jsx(Button,{className:\"my-3\",variant:\"contained\",color:\"primary\",type:\"submit\",size:\"large\",children:\" Update user \"})]});}})})]})});};export default EditProfile;","map":{"version":3,"sources":["C:/Users/מלאך גל/Desktop/Projects/Instagram-master/client/src/components/editProfile/EditProfile.js"],"names":["React","useState","useEffect","Input","IconButton","Collapse","TextField","Button","InputAdornment","ImageIcon","CloseIcon","VisibilityIcon","VisibilityOffIcon","Alert","Modal","Formik","Yup","EditProfile","modal","setModal","JSON","parse","localStorage","getItem","id","closeModal","message","setMessage","openAlert","setOpenAlert","fileName","setFileName","previewSource","setPreviewSource","isProfile","setIsProfile","username","password","description","userProfile","setUserProfile","showPassword","setShowPassword","validationSchema","object","shape","string","required","min","errorHelper","formik","values","error","errors","touched","helperText","getUser","fetch","res","json","data","user","profileFileName","profileDescription","photo","editProfile","resetForm","reader","FileReader","readAsDataURL","onloadend","result","updateSettings","method","headers","body","stringify","response","setItem","handleClickShowPassword","handleChangeImage","e","setFieldValue","target","files","length","name","fontWeight","margin","props","textAlign","handleSubmit","getFieldProps","endAdornment","display"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\n// material ui\nimport { Input, IconButton, Collapse, TextField, Button, InputAdornment  } from '@material-ui/core';\nimport ImageIcon from '@material-ui/icons/Image';\nimport CloseIcon from '@material-ui/icons/Close';\nimport VisibilityIcon from '@material-ui/icons/Visibility';\nimport VisibilityOffIcon from '@material-ui/icons/VisibilityOff';\nimport Alert from '@material-ui/lab/Alert';\n// bootstrap \nimport Modal from 'react-bootstrap/Modal'\n// Formik\nimport { Formik } from 'formik';\nimport * as Yup from 'yup';\n\nconst EditProfile = ({ modal, setModal}) => {\n   const { id } = JSON.parse(localStorage.getItem('user'))\n    const closeModal = () => setModal(false)\n    const [message, setMessage] = useState('')\n    const [openAlert, setOpenAlert] = useState(false)\n    const [fileName, setFileName] = useState('')\n    const [previewSource, setPreviewSource] = useState('')\n    const [isProfile, setIsProfile] = useState(false)\n    const [userProfile, setUserProfile] = useState({username:'', password:'', description:''})\n    const [showPassword, setShowPassword] = useState(false)\n   \n    // Formik\n    const validationSchema = Yup.object().shape({\n        username:Yup.string()\n        .required('username is required'),\n        password:Yup.string()\n        .required('password is required'),\n        description:Yup.string()\n        .min(6, 'That it? write some more(min 6 characters)'),\n      })\n\n      const errorHelper = (formik,values) => ({\n        error: formik.errors[values] && formik.touched[values] ? true : false,\n        helperText: formik.errors[values] && formik.touched[values] ? formik.errors[values]:null\n    })\n\n    // Get user's information\n      const getUser = async () => {\n        const res = await fetch(`/user/${id}`)\n        const data = await res.json()\n        const { username, password, profileFileName, profileDescription } = data.user\n        setUserProfile({ username, password, description: profileDescription, photo:'' })\n        setFileName(profileFileName)\n        \n      }\n\n      // turn the image file to url\n      const editProfile =  (values,resetForm) => {\n        values.fileName = fileName\n        if(typeof values.photo === 'object' ) {\n         const reader = new FileReader()\n         reader.readAsDataURL(values.photo)\n         reader.onloadend = () => {\n           values.photo = reader.result\n           updateSettings(values,resetForm)\n         }\n        } else {\n            updateSettings(values,resetForm)\n        }\n       }\n\n       // update the user profile\n      const updateSettings = async (values,resetForm) => {\n        const response = await fetch('/user', { \n        method: 'PATCH',\n        headers: {\n            'Content-Type':'application/json'\n        },\n        body: JSON.stringify({...values, id, fileName })\n    })\n        const data = await response.json()\n        if(data.user) {\n            localStorage.setItem('user', JSON.stringify(data.user))\n            resetForm()\n            setModal(false)\n        } else {\n            setMessage(data.error)\n            setOpenAlert(true)\n        }\n      }\n\n      // Handle password visiblity \n      const  handleClickShowPassword = () => {\n        setShowPassword(!showPassword)\n      }\n\n      // Handle image change  \n      const handleChangeImage = (e,setFieldValue) => {\n          const reader = new FileReader()\n          setFieldValue(\"photo\", e.target.files[0])\n          if(e.target.files.length === 0) {\n            setIsProfile(false)\n            setFileName('')\n            setPreviewSource('')\n          } \n          else {\n            reader.readAsDataURL(e.target.files[0])\n            reader.onloadend = () => {\n              setPreviewSource(reader.result)\n            }\n            setIsProfile(true)\n            setFileName(e.target.files[0].name)\n          }\n      }\n\n        useEffect(() => {\n          getUser()\n        }, [])\n\n  \n    return (\n        <div>\n            <Modal size=\"lg\" centered show={modal} onHide={closeModal}>\n                 <Modal.Header className=\"\"> <Modal.Title style={{fontWeight:'700',margin:'auto'}}> Edit your profile </Modal.Title> </Modal.Header>\n                 <Modal.Body>\n\n                 <Formik\n                    initialValues={userProfile}\n                    onSubmit={(values,{resetForm}) => editProfile(values, resetForm)}\n                    validationSchema={validationSchema}\n                    enableReinitialize={true}>\n                    {(props) => (\n                        <form style={{textAlign:'center'}} onSubmit={props.handleSubmit} autoComplete=\"off\">\n                                <TextField name=\"username\" label=\"User name\" variant=\"outlined\" fullWidth {...props.getFieldProps('username')} {...errorHelper(props,'username')}/>   \n                                \n                                <TextField InputProps={{\n                                    endAdornment: (\n                                        <InputAdornment position=\"end\">\n                                            <IconButton onClick={handleClickShowPassword}> {showPassword ? <VisibilityOffIcon /> : <VisibilityIcon />}  </IconButton>\n                                        </InputAdornment>\n                                        )}}  \n                                    type={showPassword ? \"text\": \"password\"} variant=\"outlined\" margin=\"normal\" fullWidth name=\"password\" label=\"Password\" {...props.getFieldProps('password')} {...errorHelper(props,'password')} />   \n                           \n                                <TextField  multiline rows={4} variant=\"outlined\" margin=\"normal\" fullWidth label=\"add profile description\" name=\"description\" {...props.getFieldProps('description')} {...errorHelper(props,'description')}/>\n                         \n                                <Input id=\"file\"  className=\"inputfile\" type=\"file\" name=\"photo\" onChange={(e) => handleChangeImage(e,props.setFieldValue )} hidden/> \n                                <Button style={{display:'block', margin:'5px 0px'}} color='primary'  variant=\"outlined\"><ImageIcon className=\"\"/><label htmlFor=\"file\">{fileName ? `${fileName} UPLOADED` : 'IMAGE PROFILE'} </label></Button>\n                                {props.errors.photo && props.touched.photo ?  <div className=\"error\">{props.errors.photo}</div>  : null}\n\n                                  {/* Alert error */}\n                                    <Collapse in={openAlert}>\n                                        <Alert\n                                        severity=\"error\"\n                                        action={ <IconButton color=\"inherit\" size=\"small\" onClick={() => setOpenAlert(false) }> <CloseIcon fontSize=\"inherit\" /> </IconButton>}>\n                                        {message}\n                                        </Alert>\n                                        </Collapse>\n                                <Button className=\"my-3\" variant=\"contained\" color=\"primary\" type=\"submit\" size=\"large\"> Update user </Button>\n                         </form> )}\n                    </Formik>  \n                 </Modal.Body>\n            </Modal>\n        </div>\n    )\n}\n\nexport default EditProfile\n"]},"metadata":{},"sourceType":"module"}