{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/\\u05DE\\u05DC\\u05D0\\u05DA \\u05D2\\u05DC/Desktop/Projects/Instagram-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/\\u05DE\\u05DC\\u05D0\\u05DA \\u05D2\\u05DC/Desktop/Projects/Instagram-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/\\u05DE\\u05DC\\u05D0\\u05DA \\u05D2\\u05DC/Desktop/Projects/Instagram-master/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';// Components\nimport ProfileImageModal from'../profileImageModal/ProfileImageModal';import EditProfile from'../editProfile/EditProfile';import Loader from'../loader/Loader';// Material ui\nimport{Grid}from'@material-ui/core';import SettingsIcon from'@material-ui/icons/Settings';import FavoriteIcon from'@material-ui/icons/Favorite';import ChatBubbleRoundedIcon from'@material-ui/icons/ChatBubbleRounded';// Cloudinary\nimport{Image}from'cloudinary-react';// Css\nimport'./style.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Profile=function Profile(props){var id=props.match.params.id;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),userProfile=_useState2[0],setUserProfile=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),posts=_useState4[0],setPosts=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),imageModal=_useState6[0],setImageModal=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),modal=_useState8[0],setModal=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),modalImage=_useState10[0],setModalImage=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isAllowEdit=_useState12[0],setisAllowEdit=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isFollowed=_useState14[0],setIsFollowed=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),numberOfFollowers=_useState16[0],setnumberOfFollowers=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),numberOfFollowing=_useState18[0],setnumberOfFollowing=_useState18[1];var user=JSON.parse(localStorage.getItem('user'));var getUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"/user/\".concat(id));case 2:res=_context.sent;_context.next=5;return res.json();case 5:data=_context.sent;setUserProfile(data.user);case 7:case\"end\":return _context.stop();}}},_callee);}));return function getUser(){return _ref.apply(this,arguments);};}();var getUserPosts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,_yield$res$json,postArr,numberOfFollowers,numberOfFollowing;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(\"/post/\".concat(id));case 2:res=_context2.sent;_context2.next=5;return res.json();case 5:_yield$res$json=_context2.sent;postArr=_yield$res$json.postArr;numberOfFollowers=_yield$res$json.numberOfFollowers;numberOfFollowing=_yield$res$json.numberOfFollowing;console.log(postArr);setnumberOfFollowers(numberOfFollowers);setnumberOfFollowing(numberOfFollowing);console.log(postArr);setPosts(postArr);case 14:case\"end\":return _context2.stop();}}},_callee2);}));return function getUserPosts(){return _ref2.apply(this,arguments);};}();var setFollow=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res,data,_res,_data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!isFollowed){_context3.next=10;break;}_context3.next=3;return fetch('/user/unfollow',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userWhoWantstoUnfollow:user.id,userWhoGetsUnfollowed:id})});case 3:res=_context3.sent;_context3.next=6;return res.json();case 6:data=_context3.sent;if(data.success){setIsFollowed(false);setnumberOfFollowers(numberOfFollowers-1);user.Followings=user.Followings.filter(function(followed){return Number(followed.followed_id)!==Number(id);});localStorage.setItem('user',JSON.stringify(user));}_context3.next=17;break;case 10:_context3.next=12;return fetch('/user/follow',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userWhoWantToFollow:user.id,userWhoGetsFollower:id})});case 12:_res=_context3.sent;_context3.next=15;return _res.json();case 15:_data=_context3.sent;if(_data.success){setnumberOfFollowers(numberOfFollowers+1);user.Followings.push({UserId:Number(user.id),followed_id:Number(id)});localStorage.setItem('user',JSON.stringify(user));setIsFollowed(true);}case 17:case\"end\":return _context3.stop();}}},_callee3);}));return function setFollow(){return _ref3.apply(this,arguments);};}();var handleImageModal=function handleImageModal(post){setModalImage(post);setImageModal(true);};useEffect(function(){getUser();getUserPosts();if(Number(id)===Number(JSON.parse(localStorage.getItem('user')).id)){setisAllowEdit(true);}else{setisAllowEdit(false);}if(user.Followings.find(function(followed){return Number(followed.followed_id)===Number(id);})){setIsFollowed(true);}else{console.log(false);setIsFollowed(false);}},[modal,id]);return/*#__PURE__*/_jsxs(_Fragment,{children:[posts&&userProfile?/*#__PURE__*/_jsxs(\"div\",{className:\"profile-main\",children:[/*#__PURE__*/_jsx(\"header\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"profile\",style:{margin:'0px'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"profile-image\",children:/*#__PURE__*/_jsx(Image,{cloudName:\"malachcloud\",publicId:userProfile.profile,width:\"200\",crop:\"scale\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile-user-settings\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"profile-user-name\",children:[\" \",userProfile.username,\" \"]}),isAllowEdit?/*#__PURE__*/_jsx(\"button\",{className:\"btn profile-edit-btn\",onClick:function onClick(){return setModal(true);},children:\"Edit Profile\"}):/*#__PURE__*/_jsx(\"button\",{className:\"btn profile-edit-btn\",onClick:function onClick(){return setFollow();},children:isFollowed?'Unfollow':'Follow'}),/*#__PURE__*/_jsx(\"button\",{className:\"btn profile-settings-btn\",children:/*#__PURE__*/_jsx(SettingsIcon,{})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-stats\",children:/*#__PURE__*/_jsxs(\"ul\",{style:{padding:'10px 2px 3px'},children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"profile-stat-count\",children:posts.length}),\" posts\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"profile-stat-count\",children:numberOfFollowers}),\" followers\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"profile-stat-count\",children:numberOfFollowing}),\" following\"]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-bio\",children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"profile-real-name\",children:userProfile.username}),\" \",userProfile.profileDescription,\" \\uD83D\\uDCF7\\u2708\\uFE0F\\uD83C\\uDFD5\\uFE0F\"]})})]})})}),/*#__PURE__*/_jsx(\"main\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"gallery\",children:/*#__PURE__*/_jsx(Grid,{container:true,children:posts.length!==0?posts.slice(0).reverse().map(function(post){return/*#__PURE__*/_jsx(Grid,{item:true,xs:4,onClick:function onClick(){return handleImageModal(post);},children:/*#__PURE__*/_jsxs(\"div\",{className:\"gallery-item\",tabIndex:\"0\",children:[/*#__PURE__*/_jsx(\"img\",{src:post.photo,className:\"gallery-image\",alt:\"\"}),/*#__PURE__*/_jsx(\"div\",{className:\"gallery-item-info\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{className:\"gallery-item-likes\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"visually-hidden\",children:\"Likes:\"}),\" \",/*#__PURE__*/_jsx(FavoriteIcon,{}),\" \",post.likes]}),/*#__PURE__*/_jsxs(\"li\",{className:\"gallery-item-comments\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"visually-hidden\",children:\"Comments:\"}),/*#__PURE__*/_jsx(ChatBubbleRoundedIcon,{}),\" \",post.comments.length]})]})})]})});}):/*#__PURE__*/_jsxs(\"div\",{className:\"no_post_div\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"No posts yet\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Go back to the home page and upload some..\"})]})})})})})]}):/*#__PURE__*/_jsx(Loader,{}),/*#__PURE__*/_jsx(EditProfile,{modal:modal,setModal:setModal}),/*#__PURE__*/_jsx(ProfileImageModal,{imageModal:imageModal,setImageModal:setImageModal,modalImage:modalImage})]});};export default Profile;","map":{"version":3,"sources":["C:/Users/◊û◊ú◊ê◊ö ◊í◊ú/Desktop/Projects/Instagram-master/client/src/components/profile/Profile.js"],"names":["React","useState","useEffect","ProfileImageModal","EditProfile","Loader","Grid","SettingsIcon","FavoriteIcon","ChatBubbleRoundedIcon","Image","Profile","props","id","match","params","userProfile","setUserProfile","posts","setPosts","imageModal","setImageModal","modal","setModal","modalImage","setModalImage","isAllowEdit","setisAllowEdit","isFollowed","setIsFollowed","numberOfFollowers","setnumberOfFollowers","numberOfFollowing","setnumberOfFollowing","user","JSON","parse","localStorage","getItem","getUser","fetch","res","json","data","getUserPosts","postArr","console","log","setFollow","method","headers","body","stringify","userWhoWantstoUnfollow","userWhoGetsUnfollowed","success","Followings","filter","followed","Number","followed_id","setItem","userWhoWantToFollow","userWhoGetsFollower","push","UserId","handleImageModal","post","find","margin","profile","username","padding","length","profileDescription","slice","reverse","map","photo","likes","comments"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\n// Components\nimport ProfileImageModal from '../profileImageModal/ProfileImageModal'\nimport EditProfile from '../editProfile/EditProfile'\nimport Loader from '../loader/Loader'\n// Material ui\nimport { Grid } from '@material-ui/core'\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport FavoriteIcon from '@material-ui/icons/Favorite';\nimport ChatBubbleRoundedIcon from '@material-ui/icons/ChatBubbleRounded';\n// Cloudinary\nimport {Image} from 'cloudinary-react';\n// Css\nimport './style.css'\n\n\nconst Profile = (props) =>  {\n    const id = props.match.params.id\n    const [userProfile, setUserProfile] = useState('')\n    const [posts, setPosts] = useState('')\n    const [imageModal, setImageModal] = useState(true)\n    const [modal, setModal] = useState(false)\n    const [modalImage, setModalImage] = useState('')\n    const [isAllowEdit, setisAllowEdit] = useState(false)\n    const [isFollowed, setIsFollowed] = useState(false)\n    const [numberOfFollowers, setnumberOfFollowers] = useState('')\n    const [numberOfFollowing, setnumberOfFollowing] = useState('')\n    const user = JSON.parse(localStorage.getItem('user'))\n    \n    const getUser = async () => {\n        const res = await fetch(`/user/${id}`)\n        const data = await res.json()\n        setUserProfile(data.user)\n    }\n\n\n    const getUserPosts = async () => {\n        const res = await fetch(`/post/${id}`)\n      \n        const { postArr, numberOfFollowers,  numberOfFollowing} = await res.json()\n        console.log(postArr);\n        setnumberOfFollowers(numberOfFollowers)\n        setnumberOfFollowing(numberOfFollowing)\n        console.log(postArr);\n        setPosts(postArr)\n    }\n\n    const setFollow = async () => {\n        // make unfolow\n        if(isFollowed) {\n            const res = await fetch('/user/unfollow', {\n            method: 'POST',\n            headers: {\n                'Content-Type':'application/json'\n            },\n            body: JSON.stringify({userWhoWantstoUnfollow: user.id , userWhoGetsUnfollowed: id })\n          })\n          const data = await res.json()\n          if(data.success) { \n            setIsFollowed(false)\n            setnumberOfFollowers(numberOfFollowers - 1)\n              user.Followings = user.Followings.filter(followed => Number(followed.followed_id) !== Number(id))\n              localStorage.setItem('user', JSON.stringify(user))\n             \n          }\n        } else {\n            // make follow\n                const res = await fetch('/user/follow', {\n                method: 'POST',\n                headers: {\n                    'Content-Type':'application/json'\n                },\n                body: JSON.stringify({userWhoWantToFollow: user.id , userWhoGetsFollower: id })\n              })\n              const data = await res.json()\n              if(data.success) {\n                setnumberOfFollowers(numberOfFollowers + 1)\n                  user.Followings.push({UserId:Number(user.id), followed_id: Number(id)})\n                  localStorage.setItem('user', JSON.stringify(user))\n                  setIsFollowed(true)\n              }\n        \n    }\n}\n\nconst handleImageModal = (post) => {\n    setModalImage(post)\n    setImageModal(true)\n}\n\n    useEffect(() => {\n       getUser()\n       getUserPosts() \n       if (Number(id) === Number(JSON.parse(localStorage.getItem('user')).id)) {\n        setisAllowEdit(true)\n       } else {\n        setisAllowEdit(false)\n       }\n       if(user.Followings.find(followed => Number(followed.followed_id) === Number(id))) {\n        setIsFollowed(true)\n       } else {\n        console.log(false)\n        setIsFollowed(false)\n       }\n    }, [modal,id])\n\n    return (\n        <>\n        {posts && userProfile ?\n        <div className=\"profile-main\">\n           <header>\n            <div className=\"container\">\n              <div className=\"profile\" style={{margin:'0px'}}>\n                  <div className=\"profile-image\">\n                  <Image cloudName=\"malachcloud\" publicId={userProfile.profile} width=\"200\" crop=\"scale\" />\n                  </div>\n\n                 <div className=\"profile-user-settings\">\n                    <h2 className=\"profile-user-name\"> {userProfile.username} </h2>\n                    {isAllowEdit ? \n                    <button className=\"btn profile-edit-btn\" onClick={() => setModal(true)}>Edit Profile</button>\n                    :\n                    <button className=\"btn profile-edit-btn\" onClick={() => setFollow()}>{isFollowed ? 'Unfollow' : 'Follow' }</button>\n                    }\n                    <button className=\"btn profile-settings-btn\"><SettingsIcon/></button>\n                </div>\n\n                <div className=\"profile-stats\">\n                    <ul style={{padding:'10px 2px 3px'}}>\n                        <li><span className=\"profile-stat-count\">{posts.length}</span> posts</li>\n                        <li><span className=\"profile-stat-count\">{numberOfFollowers}</span> followers</li>\n                        <li><span className=\"profile-stat-count\">{numberOfFollowing}</span> following</li>\n                    </ul>\n                </div>\n\n                <div className=\"profile-bio\">\n                    <p><span className=\"profile-real-name\">{userProfile.username}</span> {userProfile.profileDescription} üì∑‚úàÔ∏èüèïÔ∏è</p>\n                </div>\n            </div>\n        </div>\n    </header>\n\n  <main>\n    <div className=\"container\">\n        <div className=\"gallery\">\n        <Grid container>\n        {posts.length !== 0 ? posts.slice(0).reverse().map(post => (\n            <Grid item xs={4} onClick={() => handleImageModal(post)}>\n            <div className=\"gallery-item\" tabIndex=\"0\">\n                <img src={post.photo} className=\"gallery-image\" alt=\"\"/>\n                <div className=\"gallery-item-info\">\n                    <ul>\n                        <li className=\"gallery-item-likes\"><span className=\"visually-hidden\">Likes:</span> <FavoriteIcon/> {post.likes}</li>\n                        <li className=\"gallery-item-comments\"><span className=\"visually-hidden\">Comments:</span><ChatBubbleRoundedIcon/> {post.comments.length}</li>\n                    </ul>\n                </div>\n            </div>\n            </Grid>\n        )):\n        <div className=\"no_post_div\">\n            <h1>No posts yet</h1>\n            <p>Go back to the home page and upload some..</p>\n        </div>\n        }\n        </Grid>\n        </div>\n    </div>\n </main> \n\n\n</div>\n:<Loader/>}\n\n<EditProfile modal={modal} setModal={setModal}/> \n<ProfileImageModal imageModal={imageModal} setImageModal={setImageModal} modalImage={modalImage}/>\n        </>\n    )\n}\n\nexport default Profile\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}